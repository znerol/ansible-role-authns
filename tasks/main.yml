---
- name: OS-specific variables included.
  include_vars: "{{ ansible_os_family }}.yml"

- name: Bind nameserver installed
  loop: "{{ authns_server_packages }}"
  package:
    name: "{{ item }}"
    state: present

- name: Bind main config file present
  notify:
    - Bind reloaded
  template:
    src: named.conf.j2
    dest: "{{ authns_bind_main_file }}"
    owner: root
    group: root
    mode: 0644

- name: Bind zones config file present
  notify:
    - Bind reloaded
  copy:
    content: ""
    dest: "{{ authns_bind_config_file }}"
    force: no
    owner: root
    group: root
    mode: 0644

- name: Bind configured as authoritative-only nameserver
  notify:
    - Bind reloaded
  template:
    src: named.conf.options.j2
    dest: "{{ authns_bind_options_file }}"

- name: Bind enabled and service started
  service:
    name: "{{ authns_service }}"
    enabled: yes
    state: started
